<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intramurals 2026 | Matches & Results</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
        }

        .sidebar-transition {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-link {
            transition: all 0.2s ease;
            color: #64748b;
        }

        .nav-link:hover {
            background: rgba(59, 130, 246, 0.05);
            color: #2563eb;
        }

        .nav-link.active {
            background: #2563eb;
            color: white;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 10px;
        }

        .match-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .match-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>

<body class="overflow-x-hidden">

    <!-- Mobile Sidebar Overlay -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-slate-900/50 z-40 hidden backdrop-blur-sm"></div>

    <!-- Navigation Sidebar -->
    <aside id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-white border-r border-slate-200 z-50 transform -translate-x-full lg:translate-x-0 sidebar-transition shadow-xl lg:shadow-none">
        <div class="p-6 h-full flex flex-col">
            <div class="flex items-center gap-3 mb-8">
                <div class="h-10 w-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-200">
                    <i class="fas fa-trophy"></i>
                </div>
                <div>
                    <h1 class="font-extrabold text-slate-900 text-sm tracking-tight leading-none uppercase">Intramurals</h1>
                    <span class="text-[10px] font-bold text-blue-600 uppercase tracking-widest">2026 Season</span>
                </div>
            </div>

            <nav class="space-y-1 flex-1 overflow-y-auto custom-scrollbar">
                <a href="home.html" class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl text-xs font-bold">
                    <i class="fas fa-house w-5"></i> Home
                </a>
                <a href="sports.html" class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl text-xs font-bold">
                    <i class="fas fa-volleyball w-5"></i> Sports
                </a>
                <a href="teams.html" class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl text-xs font-bold">
                    <i class="fas fa-users w-5"></i> Teams
                </a>
                <a href="players.html" class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl text-xs font-bold">
                    <i class="fas fa-user-graduate w-5"></i> Players
                </a>
                <a href="leaderboard.html" class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl text-xs font-bold">
                    <i class="fas fa-ranking-star w-5"></i> Leaderboard
                </a>
                <a href="MVPawards.html" class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl text-xs font-bold group">
                    <i class="fas fa-medal w-5 group-hover:text-yellow-500 transition-colors"></i> MVP Awards
                </a>
                <a href="matches&results.html" class="nav-link active flex items-center gap-3 px-4 py-3 rounded-xl text-xs font-bold">
                    <i class="fas fa-calendar-check w-5"></i> Matches & Results
                </a>
                <div class="pt-4 mt-4 border-t border-slate-100">
                    <a href="about.html" class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl text-xs font-bold">
                        <i class="fas fa-circle-info w-5"></i> About
                    </a>
                </div>
            </nav>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="lg:ml-64 min-h-screen p-4 md:p-8">
        <!-- Header -->
        <header class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
            <div>
                <h2 class="text-2xl font-black text-slate-900 uppercase tracking-tight">Matches & Results</h2>
                <p class="text-slate-500 text-xs font-bold uppercase tracking-wider" id="currentDate">Loading date...</p>
            </div>
            <div class="flex items-center gap-3">
                <button id="openSidebar" class="lg:hidden h-10 w-10 flex items-center justify-center bg-white border border-slate-200 rounded-xl">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="px-4 py-2 bg-blue-50 border border-blue-100 rounded-2xl">
                    <span class="text-[10px] font-black text-blue-600 uppercase tracking-widest">
                        <i class="fas fa-history mr-1"></i> Game History
                    </span>
                </div>
            </div>
        </header>

        <!-- Filters Section -->
        <section class="mb-8 animate-fade-in">
            <div class="flex flex-wrap items-center gap-3">
                <button onclick="filterMatches('all')" id="filter-all" class="filter-btn px-5 py-2.5 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-lg shadow-blue-100 transition-all">All Matches</button>
                <button onclick="filterMatches('completed')" id="filter-completed" class="filter-btn px-5 py-2.5 bg-white border border-slate-200 text-slate-500 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:border-blue-200 transition-all">Results</button>
                <button onclick="filterMatches('scheduled')" id="filter-scheduled" class="filter-btn px-5 py-2.5 bg-white border border-slate-200 text-slate-500 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:border-blue-200 transition-all">Scheduled</button>
                
                <div class="ml-auto hidden md:block">
                    <div class="relative">
                        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-xs"></i>
                        <input type="text" id="matchSearch" placeholder="SEARCH TEAMS OR SPORTS..." class="pl-10 pr-4 py-2.5 bg-white border border-slate-200 rounded-2xl text-[10px] font-bold uppercase tracking-widest focus:outline-none focus:ring-2 focus:ring-blue-500/20 w-64">
                    </div>
                </div>
            </div>
        </section>

        <!-- Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Main List -->
            <div class="lg:col-span-2 space-y-6">
                <div id="matchesContainer" class="space-y-4">
                    <!-- Loading State -->
                    <div class="p-8 text-center bg-white border border-slate-100 rounded-[2rem]">
                        <div class="animate-spin inline-block w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mb-4"></div>
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Syncing match history...</p>
                    </div>
                </div>
            </div>

            <!-- Side Highlights -->
            <div class="space-y-6">
                <!-- Recent MVPs Section -->
                <section class="bg-white border border-slate-200 rounded-[2rem] overflow-hidden shadow-sm animate-fade-in" style="animation-delay: 0.2s">
                    <div class="p-6 border-b border-slate-50">
                        <h4 class="text-xs font-black text-slate-900 uppercase tracking-widest">Recent Match MVPs</h4>
                        <p class="text-[9px] font-bold text-slate-400 uppercase mt-1">Standout performers from last games</p>
                    </div>
                    <div id="mvpList" class="p-4 space-y-3">
                        <!-- MVPs injected here -->
                        <div class="p-4 bg-slate-50 rounded-2xl animate-pulse h-12"></div>
                        <div class="p-4 bg-slate-50 rounded-2xl animate-pulse h-12"></div>
                    </div>
                </section>

                <!-- Quick Stats -->
                <section class="p-6 bg-gradient-to-br from-slate-900 to-slate-800 rounded-[2rem] text-white shadow-xl animate-fade-in" style="animation-delay: 0.3s">
                    <h4 class="text-[10px] font-black uppercase tracking-[0.2em] text-blue-400 mb-6">Season Summary</h4>
                    <div class="space-y-6">
                        <div class="flex items-center justify-between">
                            <span class="text-xs font-bold text-slate-400 uppercase">Matches Played</span>
                            <span id="statPlayed" class="text-xl font-black">0</span>
                        </div>
                        <div class="h-px bg-white/10"></div>
                        <div class="flex items-center justify-between">
                            <span class="text-xs font-bold text-slate-400 uppercase">Avg. Score</span>
                            <span id="statAvg" class="text-xl font-black">0.0</span>
                        </div>
                        <div class="h-px bg-white/10"></div>
                        <div class="flex items-center justify-between">
                            <span class="text-xs font-bold text-slate-400 uppercase">Upcoming Games</span>
                            <span id="statUpcoming" class="text-xl font-black text-blue-400">0</span>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD5Gkjk7tk48Hv9zgvdlSsdR8FH_nwtGRc",
            authDomain: "intramurals-score-leaderboard.firebaseapp.com",
            projectId: "intramurals-score-leaderboard",
            storageBucket: "intramurals-score-leaderboard.firebasestorage.app",
            messagingSenderId: "455345215033",
            appId: "1:455345215033:web:66a387d0fa0fa4453e5fe8",
            measurementId: "G-E0GM8X4K9L"
        };

        const currentAppId = 'intramurals-2026';
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let state = {
            matches: [],
            teams: [],
            sports: [],
            players: [],
            filter: 'all',
            searchQuery: ''
        };

        window.onload = () => {
            updateDate();
            initAuth();
            setupSidebar();
            setupSearch();
        };

        const updateDate = () => {
            const el = document.getElementById('currentDate');
            if (el) el.textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        };

        const setupSidebar = () => {
            const overlay = document.getElementById('sidebarOverlay');
            const sidebar = document.getElementById('sidebar');
            document.getElementById('openSidebar').onclick = () => {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            };
            overlay.onclick = () => {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            };
        };

        const setupSearch = () => {
            document.getElementById('matchSearch').oninput = (e) => {
                state.searchQuery = e.target.value.toLowerCase();
                renderMatches();
            };
        };

        window.filterMatches = (type) => {
            state.filter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white', 'shadow-lg', 'shadow-blue-100');
                btn.classList.add('bg-white', 'border', 'border-slate-200', 'text-slate-500');
            });
            const activeBtn = document.getElementById(`filter-${type}`);
            activeBtn.classList.remove('bg-white', 'border', 'border-slate-200', 'text-slate-500');
            activeBtn.classList.add('bg-blue-600', 'text-white', 'shadow-lg', 'shadow-blue-100');
            renderMatches();
        };

        const initAuth = async () => {
            try {
                await signInAnonymously(auth);
                onAuthStateChanged(auth, (user) => {
                    if (user) loadData();
                });
            } catch (error) {
                console.error("Auth failed", error);
            }
        };

        const loadData = () => {
            const basePath = ['artifacts', currentAppId, 'public', 'data'];

            onSnapshot(collection(db, ...basePath, 'sports'), (snap) => {
                state.sports = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                renderMatches();
            });

            onSnapshot(collection(db, ...basePath, 'teams'), (snap) => {
                state.teams = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                renderMatches();
            });

            onSnapshot(collection(db, ...basePath, 'players'), (snap) => {
                state.players = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                renderMVPs();
            });

            onSnapshot(collection(db, ...basePath, 'matches'), (snap) => {
                state.matches = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                updateStats();
                renderMatches();
                renderMVPs();
            });
        };

        const updateStats = () => {
            const completed = state.matches.filter(m => m.status === 'completed');
            const scheduled = state.matches.filter(m => m.status !== 'completed');
            
            document.getElementById('statPlayed').textContent = completed.length;
            document.getElementById('statUpcoming').textContent = scheduled.length;
            
            let totalScores = 0;
            completed.forEach(m => {
                totalScores += (parseInt(m.scoreA) || 0) + (parseInt(m.scoreB) || 0);
            });
            const avg = completed.length ? (totalScores / (completed.length * 2)).toFixed(1) : "0.0";
            document.getElementById('statAvg').textContent = avg;
        };

        const renderMatches = () => {
            const container = document.getElementById('matchesContainer');
            
            let filtered = state.matches.sort((a, b) => {
                // Sort by date or status
                if (a.status === 'completed' && b.status !== 'completed') return 1;
                if (a.status !== 'completed' && b.status === 'completed') return -1;
                return 0;
            });

            if (state.filter !== 'all') {
                filtered = filtered.filter(m => m.status === state.filter);
            }

            if (state.searchQuery) {
                filtered = filtered.filter(m => {
                    const teamA = state.teams.find(t => t.id === m.teamAId)?.name?.toLowerCase() || '';
                    const teamB = state.teams.find(t => t.id === m.teamBId)?.name?.toLowerCase() || '';
                    const sport = state.sports.find(s => s.id === m.sportId)?.name?.toLowerCase() || '';
                    return teamA.includes(state.searchQuery) || teamB.includes(state.searchQuery) || sport.includes(state.searchQuery);
                });
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="p-12 text-center bg-white border border-dashed border-slate-200 rounded-[2rem]">
                        <i class="fas fa-search text-3xl text-slate-200 mb-4"></i>
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">No matches found matching criteria</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(m => {
                const teamA = state.teams.find(t => t.id === m.teamAId) || { name: 'Team A' };
                const teamB = state.teams.find(t => t.id === m.teamBId) || { name: 'Team B' };
                const sport = state.sports.find(s => s.id === m.sportId) || { name: 'Match' };
                const isCompleted = m.status === 'completed';
                const winnerA = isCompleted && parseInt(m.scoreA) > parseInt(m.scoreB);
                const winnerB = isCompleted && parseInt(m.scoreB) > parseInt(m.scoreA);

                return `
                    <div class="match-card p-6 bg-white border border-slate-100 rounded-[2rem] flex flex-col md:flex-row items-center gap-6 animate-fade-in">
                        <!-- Sport Tag -->
                        <div class="w-full md:w-32 flex-shrink-0">
                            <span class="inline-block px-3 py-1 bg-slate-50 border border-slate-100 rounded-lg text-[8px] font-black text-slate-500 uppercase tracking-widest mb-2">${sport.name}</span>
                            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">${m.matchDate || 'TBD'}</p>
                        </div>

                        <!-- Scoreboard -->
                        <div class="flex-1 flex items-center justify-between w-full">
                            <!-- Team A -->
                            <div class="flex-1 flex flex-col items-center md:items-end text-center md:text-right">
                                <div class="h-12 w-12 bg-slate-100 rounded-2xl flex items-center justify-center font-black text-slate-400 text-sm mb-2">
                                    ${(teamA.name || 'A').substring(0, 1).toUpperCase()}
                                </div>
                                <h5 class="text-xs font-black text-slate-900 uppercase tracking-tight truncate w-full ${winnerA ? 'text-blue-600' : ''}">${teamA.name}</h5>
                                <p class="text-[8px] font-bold text-slate-400 uppercase tracking-widest">${teamA.department || ''}</p>
                            </div>

                            <!-- VS / Score -->
                            <div class="px-6 flex flex-col items-center">
                                ${isCompleted ? `
                                    <div class="flex items-center gap-3">
                                        <span class="text-2xl font-black ${winnerA ? 'text-slate-900' : 'text-slate-400'}">${m.scoreA || 0}</span>
                                        <span class="text-[10px] font-black text-slate-200 mx-1">—</span>
                                        <span class="text-2xl font-black ${winnerB ? 'text-slate-900' : 'text-slate-400'}">${m.scoreB || 0}</span>
                                    </div>
                                    <span class="mt-1 px-2 py-0.5 bg-green-50 text-green-600 text-[8px] font-black uppercase rounded">Final</span>
                                ` : `
                                    <div class="h-10 w-10 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center text-[10px] font-black">VS</div>
                                    <span class="mt-1 text-[8px] font-black text-blue-500 uppercase tracking-widest animate-pulse">${m.status || 'Upcoming'}</span>
                                `}
                            </div>

                            <!-- Team B -->
                            <div class="flex-1 flex flex-col items-center md:items-start text-center md:text-left">
                                <div class="h-12 w-12 bg-slate-100 rounded-2xl flex items-center justify-center font-black text-slate-400 text-sm mb-2">
                                    ${(teamB.name || 'B').substring(0, 1).toUpperCase()}
                                </div>
                                <h5 class="text-xs font-black text-slate-900 uppercase tracking-tight truncate w-full ${winnerB ? 'text-blue-600' : ''}">${teamB.name}</h5>
                                <p class="text-[8px] font-bold text-slate-400 uppercase tracking-widest">${teamB.department || ''}</p>
                            </div>
                        </div>

                        <!-- Match Detail Button -->
                        <div class="w-full md:w-auto">
                            <button class="w-full md:w-10 h-10 flex items-center justify-center bg-slate-50 text-slate-400 rounded-xl hover:bg-blue-600 hover:text-white transition-all">
                                <i class="fas fa-chevron-right text-xs"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        };

        const renderMVPs = () => {
            const container = document.getElementById('mvpList');
            // Mocking "Match MVPs" logic: taking players from the most recent completed matches
            const completed = state.matches
                .filter(m => m.status === 'completed' && m.mvpId)
                .slice(0, 4);

            if (completed.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-6">
                        <p class="text-[9px] font-black text-slate-300 uppercase">No MVPs assigned yet</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = completed.map(m => {
                const player = state.players.find(p => p.id === m.mvpId);
                if (!player) return '';
                const sport = state.sports.find(s => s.id === m.sportId)?.name || 'Sport';
                
                return `
                    <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-2xl group hover:bg-white hover:shadow-sm border border-transparent hover:border-slate-100 transition-all">
                        <div class="h-10 w-10 bg-white rounded-xl flex items-center justify-center text-xs font-black text-blue-600 border border-slate-100">
                            ${(player.fullName || '??').substring(0, 2).toUpperCase()}
                        </div>
                        <div class="min-w-0 flex-1">
                            <p class="text-[10px] font-black text-slate-900 uppercase truncate">${player.fullName}</p>
                            <div class="flex items-center gap-2">
                                <span class="text-[8px] font-bold text-blue-500 uppercase italic">${sport}</span>
                                <span class="text-[8px] font-black text-slate-300">•</span>
                                <span class="text-[8px] font-bold text-slate-400 uppercase">Game MVP</span>
                            </div>
                        </div>
                        <div class="text-yellow-500">
                            <i class="fas fa-star text-[10px]"></i>
                        </div>
                    </div>
                `;
            }).join('');
        };
    </script>
</body>

</html>